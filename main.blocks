<xml xmlns="https://developers.google.com/blockly/xml"><variables><variable id="MP0Ff7(#_}eK$u%R,[y`">writeAndWaitEffort</variable><variable id="`9|y4V|T%mW?Akv`T@06">start</variable><variable id="T-UfbdLmQK{W6]OF1a8F">index</variable><variable id="cc(bslMMrR(55(5piJ%+">end</variable><variable id="4Ue:2C?v3kQk,]A.+K=D">mask</variable><variable id="v_d-WO5MPpU:KU}a.f+S">SHOT_MESSAGE</variable><variable id=".lMkVMaAO~{;jSC)7.Ib">temp1</variable><variable id="VOU,)sUjE~lns{2z0`^V">bitToTransmit</variable><variable id="KW%N@^!~9V}#NT?h.kjr">messageProcessingEffort</variable><variable id="cTg^LMIb*9;:R2~m-,p)">IR_MARK</variable><variable id="Efzbu|C1dMKP|N*3Au0d">START_STOP_PAUSE</variable><variable id="0WF4$KjW@QOddFHHvCe~">LOW_PAUSE</variable><variable id="p{9]ILhzx4@-Bj!YEMuy">HIGH_PAUSE</variable><variable id="3R^_j)vCDiL1{FEH^r6g">temp2</variable><variable id="B2szGW!8E}]]er_vQ7^4">SHOT_MESSAGE_BIT_SIZE</variable><variable id="wp)V|84)6:#soyX:!3j]">IRReceiveState</variable><variable id="3*`ODRXGbqe2=MCX@o#c">mark</variable><variable id="Kp.RO.[J7X-h~j.xdk61">space</variable><variable id="!xR^S{WB`:PvtT0b8)`j">IRRCV_DETECT_START_STOP</variable><variable id="dj9WtXqY!=LxpnOtS6TM">IRRCV_DETECT_BIT</variable><variable id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</variable><variable id="zu?}[A{)NdL5sVf^7~p+">receivedBits</variable><variable id="{(G2a?)h6lgOH$!jDzr%">lasIRShotReceived</variable><variable id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</variable><variable id="dAngqhnBXV]rtqR4@V{o">markVector</variable><variable id="Vfers.FR216YW}tA*D:n">currentIndex</variable><variable id="1yM@4_),hmq-*7$i%K_]">messageBeingSent</variable><variable id="x+~j)XXG1mkL3a7x3HeY">PLAYER_ID</variable><variable id="_zZE5QF,G=fgpBv/LH7J">PLAYER_ID_BIT_SIZE</variable><variable id="YfWW#6BVm;S#e6t^j*aC">IR_END_OF_SYMBOL</variable><variable id="t}O$n!Be9b:d3EY{G~oA">IR_PULSE_LOW_EVENT</variable><variable id="Tq.SL{i^^[e)V:qgzw4D">IR_END_OF_SHOT_MESSAGE_EVENT</variable></variables><comment id="m6H`zch+)$evCv-gJdW3" minimized="true" x="0" y="0" h="1099" w="1761">Explicação do código 

Tanta modelação para aqui e para acolá para dizer que o que conta é o tempo que dura cada símbolo no meio. Por símbolo entende-se um pedaço de 6 períodos a 1 e uma tamanho variável a 0. Para encontrarmos o início do frame é preciso um símbolo especial. Para ser despoletada uma transição depois do último bit que funcione como trigger para receber o seu fim usa-se o mesmo quadro que por isso é denominado START/STOP. Na verdade eu usei dois no início e dois no fim. Reparei que funciona melhor. Inspitei-me em código de extensões mas depois percebi porque é que não há nada na net: os timings são tramados de controlar. Por esse motivo há uma função de calibração inicial mas que no meu caso dá maus resultados e por isso usei tempos que medi caso a caso. Podem precisar de ajustes em função de como cresça o peso de processamento do código.

Seguem-se algumas explicações das fontes de inspiração a que recorri para o emissor IR. Masi abaixo aparecerá para o recetor IR.
Emissor IR =============================================================
https://github.com/philipphenkel/pxt-powerfunctions/blob/master/powerfunctions.ts.
Recriei aqui a lógica do ficheiro "powerfunctions" da extensão acima realiza para enviar mensagens de 16 bits.
Ele tb usou o TSAL6100.
Se no meu slide procurar o "Modulated IR Signal" está lá um diagrama de como são codificados todos os bits!
Na verdade só não aparece muito explícito o número de períodos PWM mas pelo código é fácil deduzir.
O código começa por calcular quanto tempo a microbit leva em média para fazer algumas operações (calibração) de modo a que os timings sejam rigorosos.
As mensagens são um inteiro de 16 bits. no pior caso estes 16 bits demoram 522 períodos PWM (de 26 microsegundos cada), ou seja 13,572 milisegundos.
Eles usam um truque engraçado: repetem 5 vezes o envio, no terceiro envio esperam alguns ms a mais e no último ainda mais e em função do que chamam canal!!!

O Head inicial e final são constituídos por um marcador (ou seja um "1" modulado) e um espaço em branco iniciais e devem demorar 45 períodos ao todo: 6 o marcador e 39 em branco.
Um "1" é constituído por 27 períodos ao todo: 6 o marcador e 21 em branco.
Um "0" é constituído por 16 períodos ao todo: 6 o marcador e 10 branco.
Conseguimos distinguir os valores binário em transmissão pelo simples facto de termos (bit 0) ou não flutuações nos período que medeiam entre o 16 e o 22 depois de se dar início 
=========================================================================

Adaptação ao meu jogo laser quest:
Não me pareceu em nada necessário incluir redundância. Talvez jogando de dia dê jeito. Por isso avanço já com o seguinte esquema:
Nas experiências comecei por usar IR_MARK=100, START_STOP_PAUSE=820, LOW_PAUSE=100 e HIGH_PAUSE=500.
funcionava para 2 bits mas não para 6 bits. Havia muitos erros de transmissão.
Naumentei para IR_MARK=200, START_STOP_PAUSE=1500, LOW_PAUSE=200 e HIGH_PAUSE=1000.

Adaptação ao meu jogo laser quest:
Não me pareceu em nada necessário incluir redundância. Talvez jogando de dia se mostre útil. Por isso avanço já com o seguinte esquema:
Nas experiências comecei por usar IR_MARK=100, START_STOP_PAUSE=820, LOW_PAUSE=100 e HIGH_PAUSE=500.
funcionava para 2 bits mas não para 6 bits. Havia muitos erros de transmissão.
Aumentei para IR_MARK=200, START_STOP_PAUSE=1500, LOW_PAUSE=200 e HIGH_PAUSE=1000 e funcionou perfeitamente com 6 bits.
Novo tempo máximo de quadro = (200*(4+18)) + 4*1500 + 18*1000 = 28,4 ms  (ainda assim muito baixo)
Não podemos esquecer que acresce a isto redundância. Aumentei para 4 o número de quadros SS a abrir e fechar a frame para ser ainda mais robusto pois estes quadros não possuem redundância binária.

O quadro terá 18 bits úteis. Juntando os 2 SS iniciais e 2 SS finais fico com um quadro que pode ter 360 a 666 períodos de 26 microsegundos, ou seja 9,360 ms a 18,648 ms.
Este tempo assumindo ainda que é vibrado por uma onda quadrada com um duty cycle de 50% é super seguro em termos de saúde ocular. Muitíssimo menos potência.
Adicionalmente permite-nos operar o LED com corrente alta sem perigo de aquecimento.

O esquema de redundância passa por enviar enviar três vezes seguidas e repetidas os mesmos 6 bits úteis base. 
Este terão a seguinte interpretação: (msb) e1 e0 j3 j2 j1 j0 (lsb) 
  - ei são bits que representam uma de quatro equipas
  - ji são bits que representam um de 16 jogadores da referida equipa
No total suportamos 64 players simultâneos.
O envio de três vezes seguidas facilita a lógica de envio e de receção.
Na receção faço votação dos bits recebidos. É preciso haver dois bits errados separados por seis bits para não detetar o erro, logo a comunicação é robusta.


Teremos de criar um modo inicial de programação (A+B) de cada pistola e capacete em que indicamos em cada Microbit, a função de operação desejada (pistola/capacete), a equipa (numa rotação de 4 valores) e depois o id do jogador numa rotação de 16 valores. Esse valor deve ser gravado na flash da microbit. O registo dos IDs deve ser feito inicialmente.

Ao receber o tiro o capacete ilumina-se com a cor da equipa alvejada por 2 segundos, depois em modo flash a cor da equipa que alvejou e novamente a continuo a cor da equipa alvejada. Desta forma por comunicação visual os jogadores percebem quem morreu e quem matou. Por rádio envia-se essa informação também, podendo a mesma ser consultada .


Posso ainda dar a possibilidade de programar dois modos de disparo: manual e automático: no primeiro envia-se uma bala. No segundo disparam-se 10 balas separadas por 100 ms.</comment><comment id="@/AW(%x}Z!T*K1g,PQDm" x="-14" y="1819" h="247" w="1629">USER INTERFACE:
A+B four consecutive times (with 1 second) =&gt; Enter into configuration mode
 
 Then the display will explain the configuration:

A: Swap between single shot and burst shot
B: Me-&gt; :How many players I shot / ME&lt;- :How many times I was shot / Best Team
A+B: How many shots I already use</comment><comment id="AX{,szbjYo:[#:|Ey7KA" x="284" y="2412" h="485" w="1758">Fonte de inspiração:
Recetor IR =============================================================
Extensão: https://github.com/1010Technologies/pxt-makerbit-ir-receiver/blob/master/infrared.ts
Na pasta Projet é o zip pxt-makerbit-ir-receiver-master.zip e o ficheiro infrared.ts
Usei como inspiração para desenhar o meu recetor que case com o de cima.
Como este terá uma thread em background será bom no final eu ter um projeto para o emissor e outro para o recetor.
Pelas minhas contas e assumindo que o pulseToPulse=tempo de mark + tempo de space
Sequência START_STOP demorará 45 períodos de 26 microsegundos ou seja pulseToPulse = 1014 microsegundos (IRMARK + START_STOP_PAUSE)
Sequência LOW demorará 16 períodos de 26 microsegundos ou seja pulseToPulse = 416 microsegundos (IRMARK + LOW_PAUSE)
Sequência HIGH demorará 27 períodso de 26 microsegundos ou seja pulseToPulse = 702 microsegundos  (IRMARK + HIGH_PAUSE)
  
  
Todos os valores foram afinados por mim de forma manual.</comment><block type="pxt-on-start" id="BI?S|h`b*DXJ6;L7]io$" x="-4" y="1111"><statement name="HANDLER"><block type="variables_set" id="/1m:![n?9S)F?#t`#6i-"><field name="VAR" id="x+~j)XXG1mkL3a7x3HeY">PLAYER_ID</field><comment>Valor de 6 bits conforme explicação externa. Mais tarde esta valor deverá ser programável manualmente e armazenável de forma não volátil. Este valor vais ser colocado nas balas para identificar quem mata quem.</comment><value name="VALUE"><shadow type="math_number" id="cw{fB-760UyOHMTWNsJY"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="Y~,Ka%C#w|N3O|p6,%zO"><field name="VAR" id="_zZE5QF,G=fgpBv/LH7J">PLAYER_ID_BIT_SIZE</field><value name="VALUE"><shadow type="math_number" id="ODmBZsJOdMl3^Frs`XN)"><field name="NUM">6</field></shadow></value><next><block type="variables_set" id="Sh8_Fi:*aXUX+-dR|{=o"><field name="VAR" id="B2szGW!8E}]]er_vQ7^4">SHOT_MESSAGE_BIT_SIZE</field><value name="VALUE"><shadow type="math_number"><field name="NUM">6</field></shadow><block type="math_arithmetic" id="RG;#V+[HMK?9YXKnm=P%"><field name="OP">MULTIPLY</field><comment>Vamos repetir a mensagem três vezes seguidas para robustez</comment><value name="A"><shadow type="math_number" id="4|FFu?6y~Cg99@3od{ru"><field name="NUM">3</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="mprqd2_G,X.kR;-!)p)G"><field name="VAR" id="_zZE5QF,G=fgpBv/LH7J">PLAYER_ID_BIT_SIZE</field></block></value></block></value><next><block type="variables_set" id="La,I@u`gY`#2PbB3aF#D"><field name="VAR" id="cTg^LMIb*9;:R2~m-,p)">IR_MARK</field><comment>-opetei por especificar valores diretamente depois de testar offline</comment><value name="VALUE"><shadow type="math_number" id="b[:5,OH4~/7+JR=]cvku"><field name="NUM">200</field></shadow></value><next><block type="variables_set" id=".cy=S#6@J:PE..4QitD;"><field name="VAR" id="Efzbu|C1dMKP|N*3Au0d">START_STOP_PAUSE</field><value name="VALUE"><shadow type="math_number" id="xu-F~6:0uvuXE4Y9-2}e"><field name="NUM">1500</field></shadow></value><next><block type="variables_set" id="?YrJY{?qG[B@*7*aj^I;"><field name="VAR" id="0WF4$KjW@QOddFHHvCe~">LOW_PAUSE</field><value name="VALUE"><shadow type="math_number" id="hfGa^]4F^%U!)y9ICcG;"><field name="NUM">200</field></shadow></value><next><block type="variables_set" id=",0.yeDCIV44TxlWo#$}^"><field name="VAR" id="p{9]ILhzx4@-Bj!YEMuy">HIGH_PAUSE</field><comment>Math.idiv((27 - 6) * 1000000, 38000) = 552</comment><value name="VALUE"><shadow type="math_number" id="=-KQ-n:OWI29j1O=43sn"><field name="NUM">1000</field></shadow></value><next><block type="procedures_callnoreturn" id="O3.ob7}3^ipcLBsAy1PP"><mutation xmlns="http://www.w3.org/1999/xhtml" name="enableIRTransmission"></mutation><field name="NAME">enableIRTransmission</field><next><block type="procedures_callnoreturn" id="*VM^@b!Z37gw2S(0qZI;"><mutation xmlns="http://www.w3.org/1999/xhtml" name="enableIRDetection"></mutation><field name="NAME">enableIRDetection</field></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="hTSm/-WOn)T@^f82M@t#" x="1685" y="1257"><field name="NAME">enableIRTransmission</field><comment>Fazia o trabalho do construtor de class InfraredDevice. Adaptei apenas para inicializar a porta analógica PWM.</comment><statement name="STACK"><block type="device_set_analog_pin" id="%V6nV~SsSK157Vj~F=g7"><field name="name">AnalogPin.P0</field><comment>We will use PWM, with a frequency of 38 KHz</comment><value name="value"><shadow type="math_number_minmax" id="8/j{x[N_q1-9P9!RcRNi"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="device_set_analog_period" id="r$8`E8POwEKDutTqVaA)"><field name="pin">AnalogPin.P0</field><value name="micros"><shadow type="math_number" id="MR[xP|z6Bi4x7K~V0RjZ"><field name="NUM">26</field></shadow></value><next><block type="pxt_controls_for" id="=6#cpp;y@8;Pw=x9/?=?"><value name="VAR"><shadow type="variables_get_reporter" id="B@ziS}aC.~q}S=X)!aR+"><field name="VAR" id="T-UfbdLmQK{W6]OF1a8F">index</field></shadow></value><value name="TO"><shadow type="math_whole_number" id="k9XyhJfpWmX#L4?iaV^Q"><field name="NUM">7</field></shadow></value><statement name="DO"><block type="device_set_analog_pin" id=",b7!;7oXj4_1I-jF|[kt"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="2D)^KGl3yLQ8e#Uh|6(1"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id="u2!+ADVIMiAl0[s%7z/y"><value name="micros"><shadow type="math_number" id="tqv,2HE~82zwC^+:yP!s"><field name="NUM">1</field></shadow></value></block></next></block></statement><next><block type="device_set_analog_pin" id="{QkOEaqy:VGt=%=e@$5|"><field name="name">AnalogPin.P0</field><comment>We will use PWM, with a frequency of 38 KHz</comment><value name="value"><shadow type="math_number_minmax" id="o]8~p11y8sCh@s^I:`}M"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">0</field></shadow></value></block></next></block></next></block></next></block></statement></block><block type="math_arithmetic" id="JDYrtTPlAk5-^I3+_`5N" disabled="true" x="583" y="1320"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="kMu5BGC*AL=HSk$hq]#!" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="5~zU@[TyqohX0%VaQyAS" disabled="true"><field name="NUM">45</field></shadow></value><value name="B"><shadow type="math_number" id="S@z*(TJ{]h!vJevV~yS]" disabled="true"><field name="NUM">6</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="]H!U-{v_M%1nFJDph$|{" disabled="true"><field name="NUM">1000000</field></shadow></value></block><block type="procedures_defnoreturn" id="Jz=fg^}#Qb5rjsXM|*74" x="2108" y="1253"><field name="NAME">transmitBitStartStop</field><comment>A calibração parece não estar a resultar. Medi e afinei com valores fixos. O bloco ao lado é o código original (deixo para referência).</comment><statement name="STACK"><block type="device_set_analog_pin" id=")KT`fP%_-|x%fB{}31~$"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="aZsBK?iU8jR?`bek6-a;"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id=":/d3]lm2ixeQ1VQieI5O"><value name="micros"><shadow type="math_number"><field name="NUM">100</field></shadow><block type="variables_get" id="$9ss8kiy8D_[vNCMnf2p"><field name="VAR" id="cTg^LMIb*9;:R2~m-,p)">IR_MARK</field></block></value><next><block type="device_set_analog_pin" id="MeH:E~X5x6Jd/vLW%L]g"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="D.#]@cTJ_Vj-J:Z?IiP0"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="control_wait_us" id="T?1TLdcOZT,oP_cnqYOU"><value name="micros"><shadow type="math_number"><field name="NUM">820</field></shadow><block type="variables_get" id="n#f4A+K`U[3VD`y~m_V8"><field name="VAR" id="Efzbu|C1dMKP|N*3Au0d">START_STOP_PAUSE</field></block></value></block></next></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="SJF/T,%qE6u94|Ly8FWb" x="2516" y="1258"><field name="NAME">transmitBitHigh</field><statement name="STACK"><block type="device_set_analog_pin" id="p#-M3%IuW#|[|,xaeL/n"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="[J3Gz]wHUKZW8io]YEA5"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id="1`#ElN9=!RSq+Ti4RUfU"><value name="micros"><shadow type="math_number"><field name="NUM">100</field></shadow><block type="variables_get" id="6U{Xfp2U7%i:l^%k_(fO"><field name="VAR" id="cTg^LMIb*9;:R2~m-,p)">IR_MARK</field></block></value><next><block type="device_set_analog_pin" id="vI^=trRU[eDYF32|ID68"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="v|zcPn;f31FCjTEX31LN"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="control_wait_us" id="1Jhd8@Rr^l`^!.TGh!)9"><value name="micros"><shadow type="math_number"><field name="NUM">500</field></shadow><block type="variables_get" id="Xlku|o3E*dXKtY%L2M8~"><field name="VAR" id="p{9]ILhzx4@-Bj!YEMuy">HIGH_PAUSE</field></block></value></block></next></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="Q=Zll-IWe{i*7M8V(ZI!" x="2890" y="1257"><field name="NAME">transmitBitLow</field><statement name="STACK"><block type="device_set_analog_pin" id="2wB5ww5fRTTWMwo3l43k"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="**P[,SAipvcOm12B-{f$"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">511</field></shadow></value><next><block type="control_wait_us" id=";0H:Sa9(5UH41,av)0SL"><value name="micros"><shadow type="math_number"><field name="NUM">100</field></shadow><block type="variables_get" id="suU,BG1q/Jsv@_yN@Qfx"><field name="VAR" id="cTg^LMIb*9;:R2~m-,p)">IR_MARK</field></block></value><next><block type="device_set_analog_pin" id="|K{^lR*O_+fZ}Y[=0Y:9"><field name="name">AnalogPin.P0</field><value name="value"><shadow type="math_number_minmax" id="u?z|RWzX#d+lJ1YUW*vy"><mutation min="0" max="1023" label="Value" precision="0"/><field name="SLIDER">0</field></shadow></value><next><block type="control_wait_us" id="jE:6`f5QgGamfiydW)Mt"><value name="micros"><shadow type="math_number"><field name="NUM">100</field></shadow><block type="variables_get" id="hJ~Xv*)i(QR[w]oT:EFC"><field name="VAR" id="0WF4$KjW@QOddFHHvCe~">LOW_PAUSE</field></block></value></block></next></block></next></block></next></block></statement></block><block type="math_js_op" id="6n*bVz3wberKHx$yug|3" disabled="true" x="585" y="1380"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_js_op" id=",;-`6Z26(Me-+@?ww85w" disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="+8inGNfcpo]=%@FZEPvi" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number" id="8)vrp|WcV`!lHamiDDMU" disabled="true"><field name="NUM">6</field></shadow></value><value name="B"><shadow type="math_number" id="Q^*[ksrh9}7$hhDw-]MK" disabled="true"><field name="NUM">1000000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="pti1:})04/$_fewlNvVt" disabled="true"><field name="NUM">38000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="=01EreJ0Gw*X3uAiG1,f" disabled="true"><field name="NUM">38000</field></shadow></value></block><block type="variables_set" id="WDi,Hd;P=ISzZ=e8q0PL" disabled="true" x="3970" y="1212"><field name="VAR" id="1yM@4_),hmq-*7$i%K_]">messageBeingSent</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="[;T7!cIjx$5k{[Y=4Q5p" disabled="true"><field name="VAR" id="v_d-WO5MPpU:KU}a.f+S">SHOT_MESSAGE</field></block></value><next><block type="variables_set" id="l=!IN_+K)=FrvB3R5xrV" disabled="true"><field name="VAR" id="4Ue:2C?v3kQk,]A.+K=D">mask</field><comment>Em binário: 0100 0000 0000 0000
A máscara será usada para transmitir bit a bit
            </comment><value name="VALUE"><shadow type="math_number"><field name="NUM">32768</field></shadow><block type="math_arithmetic" id="l5z7BV0Z]^D1V~%0m:}!" disabled="true"><field name="OP">POWER</field><value name="A"><shadow type="math_number" id="ONsp!8^qIb96NwnAtu)5" disabled="true"><field name="NUM">2</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Q$6)?#Zh4;q_Z7t,kx=y" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="1Sn*LURHc:rc)+SNEFpk" disabled="true"><field name="VAR" id="B2szGW!8E}]]er_vQ7^4">SHOT_MESSAGE_BIT_SIZE</field></block></value><value name="B"><shadow type="math_number" id="hFzXmpq^p~dZutU]:qVQ" disabled="true"><field name="NUM">1</field></shadow></value></block></value></block></value><next><block type="controls_repeat_ext" id="*T{!UOk#|6B7]HI0.?;V" disabled="true"><value name="TIMES"><shadow type="math_whole_number" id="T%u73p4|}}pM:fNA17@+" disabled="true"><field name="NUM">4</field></shadow></value><statement name="DO"><block type="procedures_callnoreturn" id="DOS$;/]j6-:u-+MWj_?E" disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitStartStop"></mutation><field name="NAME">transmitBitStartStop</field></block></statement><next><block type="device_while" id="Zfv$,G17X~7p3ArRPUuZ" disabled="true"><value name="COND"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="ip9s5eK]`?9JK1D~_JY;" disabled="true"><field name="OP">GTE</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="pVuJ~y,$gi.l%)xqbkcn" disabled="true"><field name="VAR" id="4Ue:2C?v3kQk,]A.+K=D">mask</field></block></value><value name="B"><shadow type="math_number" id="P1[mNH4+8ry8p.Z(n]2=" disabled="true"><field name="NUM">1</field></shadow></value></block></value><statement name="DO"><block type="variables_set" id="*QqLf8$JS454Gi$be=2M" disabled="true"><field name="VAR" id=".lMkVMaAO~{;jSC)7.Ib">temp1</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_js_op" id="tjh*fiVO44wW91hHibwV" disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="F6uRJFU4lhY7oCQ!nX%x" disabled="true"><field name="VAR" id="1yM@4_),hmq-*7$i%K_]">messageBeingSent</field></block></value><value name="ARG1"><shadow type="math_number" id="Y7mk90GQi@:XUH.cYsc`"><field name="NUM">0</field></shadow><block type="variables_get" id="116$s?{Hm~~nfFbx6([A" disabled="true"><field name="VAR" id="4Ue:2C?v3kQk,]A.+K=D">mask</field></block></value></block></value><next><block type="controls_if" id="p2XGCsnCB#W[C$gLzvKn" disabled="true"><mutation else="1"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="0xr|u]dg/%B{935)LriF" disabled="true"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="k7u4^1U$78y_~Kob+Z7E" disabled="true"><field name="VAR" id=".lMkVMaAO~{;jSC)7.Ib">temp1</field></block></value><value name="B"><shadow type="math_number" id="ZW!C8[H+n9LSf@lyP[YK" disabled="true"><field name="NUM">1</field></shadow></value></block></value><statement name="DO0"><block type="procedures_callnoreturn" id=".V{^cS}oDH}.$/lkBibG" disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitHigh"></mutation><field name="NAME">transmitBitHigh</field></block></statement><statement name="ELSE"><block type="procedures_callnoreturn" id="0iW@db!0=ah8+=_w#OJ," disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitLow"></mutation><field name="NAME">transmitBitLow</field></block></statement><next><block type="variables_set" id="8:TK{J3~6nR#QFRX@;7i" disabled="true"><field name="VAR" id="1yM@4_),hmq-*7$i%K_]">messageBeingSent</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="N6U`|A`(W=l1`=F1+@s~" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="NkMy))}G.*xfi2Lq(C}C" disabled="true"><field name="VAR" id="1yM@4_),hmq-*7$i%K_]">messageBeingSent</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">2</field></shadow><block type="math_arithmetic" id="es?ISV!?I%ekuNR?7`B%" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="1=dY;67~_xf5oBPmGLL3" disabled="true"><field name="VAR" id=".lMkVMaAO~{;jSC)7.Ib">temp1</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="9.XrWGY!==331@WT@0+Y" disabled="true"><field name="VAR" id="4Ue:2C?v3kQk,]A.+K=D">mask</field></block></value></block></value></block></value><next><block type="variables_set" id="!drU[.fz4.=-*m`uBQaZ" disabled="true"><field name="VAR" id="4Ue:2C?v3kQk,]A.+K=D">mask</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="GvI4`cJTC;MT{+_l*bYM" disabled="true"><field name="OP">DIVIDE</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id=";=E+)@R3/#98s7VI6Z-1" disabled="true"><field name="VAR" id="4Ue:2C?v3kQk,]A.+K=D">mask</field></block></value><value name="B"><shadow type="math_number" id="e3dUdOBgF}@.`H7WUqh3" disabled="true"><field name="NUM">2</field></shadow></value></block></value></block></next></block></next></block></next></block></statement><next><block type="controls_repeat_ext" id="=Zuf_|o5s,g;.CHkVnAc" disabled="true"><value name="TIMES"><shadow type="math_whole_number" id="2]?J9=y10x](;0Uki?fD" disabled="true"><field name="NUM">4</field></shadow></value><statement name="DO"><block type="procedures_callnoreturn" id="5=t{qQc_a+adnLO54oNI" disabled="true"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitStartStop"></mutation><field name="NAME">transmitBitStartStop</field></block></statement></block></next></block></next></block></next></block></next></block><block type="procedures_defnoreturn" id="2G2.{S$I);Yv!Y=AIiJW" x="3278" y="1250"><field name="NAME">IRShot</field><comment>Bits are sent starting on msb to lsb</comment><statement name="STACK"><block type="procedures_callnoreturn" id="TP$e9;51!N1@rr#Kp^gz"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitStartStop"></mutation><field name="NAME">transmitBitStartStop</field><next><block type="procedures_callnoreturn" id="Rrs/D_uj4emFyukqxHo="><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitHigh"></mutation><field name="NAME">transmitBitHigh</field><next><block type="procedures_callnoreturn" id="nkR@|S8fQ-ap*aQ5f|*o"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitLow"></mutation><field name="NAME">transmitBitLow</field><next><block type="procedures_callnoreturn" id=";s5D[{d@ZBD1e@Vwb!})"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitHigh"></mutation><field name="NAME">transmitBitHigh</field><next><block type="procedures_callnoreturn" id="N!o1@9HOL|497!4kM`Ow"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitLow"></mutation><field name="NAME">transmitBitLow</field><next><block type="procedures_callnoreturn" id="#Jq}Lqy}@?;CQNN2_8|{"><mutation xmlns="http://www.w3.org/1999/xhtml" name="transmitBitStartStop"></mutation><field name="NAME">transmitBitStartStop</field></block></next></block></next></block></next></block></next></block></next></block></statement></block><block type="math_js_op" id="@sZW|F5B!LY6:=P/8599" disabled="true" x="586" y="1446"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="x^t{~+:,r!@dj0QBy/d8" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="gAP(Gz+i5I)upe]~Cd3(" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="ppy1Ep#YGM7Pi9:1Hpb:" disabled="true"><field name="NUM">16</field></shadow></value><value name="B"><shadow type="math_number" id=",K~_fWykGR0@]jZx224R" disabled="true"><field name="NUM">6</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="bDF8z)JhB3%n45pD;P}e" disabled="true"><field name="NUM">1000000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="T}.6qc;8#(f6HDeGfUu8" disabled="true"><field name="NUM">38000</field></shadow></value></block><block type="math_js_op" id="H3ub:C|#6qS/s:DGynql" disabled="true" x="594" y="1520"><mutation xmlns="http://www.w3.org/1999/xhtml" op-type="infix"></mutation><field name="OP">idiv</field><value name="ARG0"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="B=T!0Xj8.gdmtzZQjR]3" disabled="true"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="r*5X0DSei[q}3k74%B?d" disabled="true"><field name="OP">MINUS</field><value name="A"><shadow type="math_number" id="|bMTH$C$:*70E)-oGI6X" disabled="true"><field name="NUM">27</field></shadow></value><value name="B"><shadow type="math_number" id="HR,CqtE#)}o?-ue=O6F}" disabled="true"><field name="NUM">6</field></shadow></value></block></value><value name="B"><shadow type="math_number" id="hJuj+b]!A7i@X-ab3:9f" disabled="true"><field name="NUM">1000000</field></shadow></value></block></value><value name="ARG1"><shadow type="math_number" id="?:#3#E_uw7?.[[]x1Gm0" disabled="true"><field name="NUM">38000</field></shadow></value></block><block type="device_button_event" id="FQeRKjz|nfnD_|iDN75_" x="-16" y="2081"><field name="NAME">Button.A</field><statement name="HANDLER"><block type="variables_change" id="p-Ovgk}h+$Rp`CSD$Ecv"><field name="VAR" id="x+~j)XXG1mkL3a7x3HeY">PLAYER_ID</field><value name="VALUE"><shadow type="math_number" id="d@CELHuX_6u.!+(ssx(x"><field name="NUM">1</field></shadow></value><next><block type="variables_set" id="P_fz-8Co!G~p0C#sQ1tn"><field name="VAR" id="v_d-WO5MPpU:KU}a.f+S">SHOT_MESSAGE</field><comment>Three consecutive replicas of PLAYER_ID for redundancy.</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="t.{epKif+-][?Z1elVRb"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id=".KgCg;@JPYb=Y.6@=7zA"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="9Sz_/lad;z(7PUa*(0|Q"><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Er~#Nv+miX%6o!RI+gzP"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="geAx~-`zYcy)E_d=#;XN"><field name="VAR" id="x+~j)XXG1mkL3a7x3HeY">PLAYER_ID</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Z|TEP$9[S2M||qQ{Jw(0"><field name="OP">POWER</field><value name="A"><shadow type="math_number" id="65nmB(cpyjCD}WdAPvui"><field name="NUM">2</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">6</field></shadow><block type="variables_get" id="7%Y[YbR0E],vz3DXuQvr"><field name="VAR" id="_zZE5QF,G=fgpBv/LH7J">PLAYER_ID_BIT_SIZE</field></block></value></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="^,!@ZHxyd6:5h;CsC6(^"><field name="VAR" id="x+~j)XXG1mkL3a7x3HeY">PLAYER_ID</field></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="tmYFGC3wZq*bP;u]KkBS"><field name="OP">POWER</field><value name="A"><shadow type="math_number" id="xJ?1HLZ;w{T~pe$+jMy#"><field name="NUM">2</field></shadow></value><value name="B"><shadow type="math_number"><field name="NUM">6</field></shadow><block type="variables_get" id="K%72CdXPf):OeGm:U]Z|"><field name="VAR" id="_zZE5QF,G=fgpBv/LH7J">PLAYER_ID_BIT_SIZE</field></block></value></block></value></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="mV*UNq[?~4qV[q`EL4fn"><field name="VAR" id="x+~j)XXG1mkL3a7x3HeY">PLAYER_ID</field></block></value></block></value><next><block type="procedures_callnoreturn" id="sk}kPlPrWzv!lqq0*!~)"><mutation xmlns="http://www.w3.org/1999/xhtml" name="IRShot"></mutation><field name="NAME">IRShot</field><next><block type="device_show_leds" id="J+_/:7:f3MGF#-,Q22^h"><field name="LEDS">`
        . . . . . 
        . . # . . 
        . . . . . 
        . . . . . 
        . . . . .
        `</field><next><block type="device_clear_display" id="d)#HS):jZZdX?sP0W([`"/></next></block></next></block></next></block></next></block></statement></block><block type="control_on_event" id="tJNY2DdDuBy/6H:MBUXs" x="2397" y="2533"><value name="src"><shadow type="control_event_source_id" id="PWS82hoFn!-F![6)Vy(W"><field name="id">EventBusSource.MICROBIT_ID_IO_P19</field></shadow></value><value name="value"><shadow type="control_event_value_id" id="a-VrbaE[o`yGMNp5nmkL"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow></value><statement name="HANDLER"><block type="variables_set" id="auv9BcZ*]zMVUusZQ2Zj"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="%1jPi_]=i-$w6ccmX2)J"><field name="OP">MINUS</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="control_event_value&quot;" id="QnvMYey=PpR[-Ve~ZV+="/></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="GvL:nGrX`]~eHc5ZH(6f"><field name="VAR" id="cTg^LMIb*9;:R2~m-,p)">IR_MARK</field></block></value></block></value><next><block type="controls_if" id="$)_u9p5kbM@)lc4AP9hJ"><mutation else="1"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="wnA2]Ig.s3Y-Xg5f{hx2"><field name="OP">AND</field><value name="A"><block type="logic_compare" id="j7*k4~:to;XfOM6.m6B}"><field name="OP">GT</field><comment>Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Q5PU@s$8lr*[c*K+m6`5"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="W+TKMdYpT-7:60baBR_z"><field name="NUM">1300</field></shadow></value></block></value><value name="B"><block type="logic_compare" id=".[lPys=StOt+)U,sQI/("><field name="OP">LT</field><comment>Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="lr~Qz;y][)jgno`}Q)x$"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="|kttOfih1fu_49uf)lfM"><field name="NUM">1700</field></shadow></value></block></value></block></value><statement name="DO0"><block type="procedures_callnoreturn" id="g/nL=x*FC)}5[fwW]#)~"><mutation xmlns="http://www.w3.org/1999/xhtml" name="Reset"></mutation><field name="NAME">Reset</field><next><block type="variables_set" id="B2gIi6Cy0]7dxqo=j*ll"><field name="VAR" id="wp)V|84)6:#soyX:!3j]">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="hG)87Ou^~p|qothmQdQZ"><field name="VAR" id="dj9WtXqY!=LxpnOtS6TM">IRRCV_DETECT_BIT</field></block></value><next><block type="basic_show_icon" id="(rr%*qD=r3Hy[=b5~946"><field name="i">IconNames.Yes</field><next><block type="device_clear_display" id="=o8IeK@mOlSt2l{.8)ai"><next><block type="device_pause" id=";$sJ2%70eDC(d|i}6`a["><value name="pause"><shadow type="timePicker" id="JR2}r:lNB1!*9h!ZqZwI"><field name="ms">100</field></shadow></value></block></next></block></next></block></next></block></next></block></statement><statement name="ELSE"><block type="controls_if" id="b;nm_F4;?iw]rWwV}dnY"><mutation elseif="1" else="1"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="rDT_$bV8.LQ4..zd+u]5"><field name="OP">AND</field><value name="A"><block type="logic_compare" id="xV!),rwMo$w}_#6f|?*l"><field name="OP">GT</field><comment>Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="D}25b2WyFsS$ALs=N$~#"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="G5=%l[*[UM9l^e-6w5iQ"><field name="NUM">800</field></shadow></value></block></value><value name="B"><block type="logic_compare" id="irr{6-jZUz0A-e7!A^c]"><field name="OP">LT</field><comment>Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="*(aHWF%2l|c3UmViQxAg"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="4D@?|Q6oyOEm9b[sQKH{"><field name="NUM">1200</field></shadow></value></block></value></block></value><statement name="DO0"><block type="procedures_callnoreturn" id="ChtQp_y#9MGyE,v:^s=6"><mutation xmlns="http://www.w3.org/1999/xhtml" name="pushBitOne"></mutation><field name="NAME">pushBitOne</field><next><block type="device_show_leds" id="JP{w|`J[JSbzm691de2l"><field name="LEDS">`
        # # # # # 
        # # # # # 
        # # # # # 
        # # # # # 
        # # # # #
        `</field><next><block type="basic_show_icon" id="7@1ffAUSZv5zZh4A8fdL"><field name="i">IconNames.SmallDiamond</field><next><block type="device_clear_display" id=";C#P/8]+/]gUWZbmF^;i"><next><block type="device_pause" id="=g26pN3sf.4KOuIcN5pz"><value name="pause"><shadow type="timePicker" id="HdH4.#]T?3%7Xpf2#9K@"><field name="ms">100</field></shadow></value></block></next></block></next></block></next></block></next></block></statement><value name="IF1"><block type="logic_operation" id="***XI,}=A[06xW?{c~0J"><field name="OP">AND</field><value name="A"><block type="logic_compare" id=":?l+w].:8@s$2Mufw#UD"><field name="OP">GT</field><comment>Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="V4:@;Qwp6|0GTUAlX{XA"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="_#L^50`^cQe9/pz^?n.6"><field name="NUM">50</field></shadow></value></block></value><value name="B"><block type="logic_compare" id="oV@ZLIx={V4hKHp1=,?w"><field name="OP">LT</field><comment>Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="p29Ru7lq#s_OSB+gYAi^"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="iJp,*H9??F9{!hDArVhJ"><field name="NUM">400</field></shadow></value></block></value></block></value><statement name="DO1"><block type="procedures_callnoreturn" id="`bfjMgYavbFE$v;X])sp"><mutation xmlns="http://www.w3.org/1999/xhtml" name="pushBitZero"></mutation><field name="NAME">pushBitZero</field><next><block type="basic_show_icon" id="~!kWN^Q{FoJ#QBx2iIf+"><field name="i">IconNames.Square</field><next><block type="device_clear_display" id="Id#[d|}g4(EmS]{X)yAr"><next><block type="device_pause" id="0d$J_3Ybo(g$@PxQ`^o$"><value name="pause"><shadow type="timePicker" id=":dk:.jgfxsjM.QjLO*Y#"><field name="ms">100</field></shadow></value></block></next></block></next></block></next></block></statement><statement name="ELSE"><block type="device_show_number" id="PmjVvN4QO;3})hx?X9.e"><value name="number"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="@Tsaz}Q%h|NBH(i$m_1u"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><next><block type="procedures_callnoreturn" id="t=[yk.,GVzg/DdPk////"><mutation xmlns="http://www.w3.org/1999/xhtml" name="Reset"></mutation><field name="NAME">Reset</field><next><block type="basic_show_icon" id="JDYNLTo]QFh*mzb=%;0M"><field name="i">IconNames.Sword</field><next><block type="device_clear_display" id="J[GSCJ]%.xoCjdqgq@Pn"><next><block type="device_pause" id="$S]Y.PT-yFL9#ee6I?4t"><value name="pause"><shadow type="timePicker" id="eFys^lY#[YT!Fb{Rp$v{"><field name="ms">100</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block></statement></block></next></block></statement></block><block type="logic_boolean" id="`Z2[4V^[/~[]dH{|_Nqs" disabled="true" x="3510" y="2582"><field name="BOOL">TRUE</field></block><block type="logic_compare" id="NzXzXzf;a`QRq3rtD#T-" disabled="true" x="3033" y="2778"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="{1]rC3Xi*:HhBP3%f6GO" disabled="true"><field name="VAR" id="wp)V|84)6:#soyX:!3j]">IRReceiveState</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="g+FXu;#.ezuN4aTAotc@" disabled="true"><field name="VAR" id="dj9WtXqY!=LxpnOtS6TM">IRRCV_DETECT_BIT</field></block></value></block><block type="procedures_defnoreturn" id="}Q-/Zdb%{/t_wXn:Fyl-" x="-10" y="3002"><field name="NAME">enableIRDetection</field><statement name="STACK"><block type="variables_set" id="LN|-?sS(ANZcl@6omlYI"><field name="VAR" id="{(G2a?)h6lgOH$!jDzr%">lasIRShotReceived</field><value name="VALUE"><shadow type="math_number" id="QC*u%D#TFlIzTP|C*i51"><field name="NUM">0</field></shadow></value><next><block type="procedures_callnoreturn" id="v+clhiVhsVtf8|UTb);r"><mutation xmlns="http://www.w3.org/1999/xhtml" name="Reset"></mutation><field name="NAME">Reset</field></block></next></block></statement></block><block type="procedures_defnoreturn" id="xGuema^L7qH3@6Y0^60E" x="403" y="3001"><field name="NAME">Reset</field><statement name="STACK"><block type="variables_set" id="X|kQi-A97o=;9iiA1I{P"><field name="VAR" id="!xR^S{WB`:PvtT0b8)`j">IRRCV_DETECT_START_STOP</field><value name="VALUE"><shadow type="math_number" id="C4g=;V?/H{pf+d?[Swga"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id="z|UWoT.T_s53jEKOd;v^"><field name="VAR" id="dj9WtXqY!=LxpnOtS6TM">IRRCV_DETECT_BIT</field><value name="VALUE"><shadow type="math_number" id="uwAnL9p)I5kF21r~gvxk"><field name="NUM">1</field></shadow></value><next><block type="variables_set" id="j4}Dhz`GX^t+!XFpX9$1"><field name="VAR" id="wp)V|84)6:#soyX:!3j]">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">777</field></shadow><block type="variables_get" id="#6GP{if~~wwu!5zsJMZJ"><field name="VAR" id="!xR^S{WB`:PvtT0b8)`j">IRRCV_DETECT_START_STOP</field></block></value><next><block type="variables_set" id="yqD}5K}W8o{ER~$$Ee-n"><field name="VAR" id="zu?}[A{)NdL5sVf^7~p+">receivedBits</field><value name="VALUE"><shadow type="math_number" id="oueh*sZxazFmN!z0x~pk"><field name="NUM">0</field></shadow></value><next><block type="variables_set" id=";XX35TKlr@l_]D2+T7)l"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field><value name="VALUE"><shadow type="math_number" id="i~%T8l-?{Y2JsvzYN*;v"><field name="NUM">0</field></shadow></value></block></next></block></next></block></next></block></next></block></statement></block><block type="pins_on_pulsed" id="A-YK91L13HYeskg}Ly|l" x="1457" y="3014"><field name="pin">DigitalPin.P2</field><field name="pulse">PulseValue.Low</field><comment>// HIGH</comment><statement name="HANDLER"><block type="variables_set" id="R]=5V^PJwpI3zvYqA:RF"><field name="VAR" id="3*`ODRXGbqe2=MCX@o#c">mark</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="pins_pulse_duration" id="w1[=)wQC|%}*_qs*RRb#"/></value></block></statement></block><block type="procedures_defnoreturn" id="MV#Iikto4SvZf}:s25zj" x="4556" y="2865"><field name="NAME">pushBitOne</field><statement name="STACK"><block type="variables_set" id="[l_A5rKxKarKwF[_q#il"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field><comment>Shift left de 1 bit</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="Em7*.l;/Ybtfo[Jv)P9L"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="q4x{Uhb(ID{sL0cTW3U^"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field></block></value><value name="B"><shadow type="math_number" id="IISr9AB#dEIP)/D6AS]h"><field name="NUM">2</field></shadow></value></block></value><next><block type="variables_change" id="Hay;=QK!F`GLOXZFv$*a"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field><value name="VALUE"><shadow type="math_number" id="7b+Rx]ib[Q1t@V(ZXf+D"><field name="NUM">1</field></shadow></value><next><block type="variables_change" id="@^eH;$As?Q,Xc}^C^/;p"><field name="VAR" id="zu?}[A{)NdL5sVf^7~p+">receivedBits</field><value name="VALUE"><shadow type="math_number" id="hf_.`hp+XV*mv^axbK}="><field name="NUM">1</field></shadow></value><next><block type="controls_if" id="XJ`_I(y-W#(@fYfL41!c"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="*nzb$AZ=~dqP-_!{7c}["><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="iQ7*iO=uK?J$C)v`OI%v"><field name="VAR" id="zu?}[A{)NdL5sVf^7~p+">receivedBits</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="qWbp0^E%L-_6{u9${?i@"><field name="VAR" id="B2szGW!8E}]]er_vQ7^4">SHOT_MESSAGE_BIT_SIZE</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="`/CUy@19/8SRA:-,k}dh"><field name="VAR" id="{(G2a?)h6lgOH$!jDzr%">lasIRShotReceived</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="UA%.-bP-|1tHt$5[iS1+"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field></block></value><next><block type="control_raise_event" id="lN~QvnMwEn_D4R$)*lZw"><value name="src"><shadow type="control_event_source_id" id="h=13N^I2=sOYw(P.!s}+"><field name="id">EventBusSource.MICROBIT_ID_IO_P20</field></shadow></value><value name="value"><shadow type="control_event_value_id"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow><block type="math_number" id="4uyd`g5.*b?Og.`pX?-X"><field name="NUM">1</field></block></value><next><block type="procedures_callnoreturn" id="]-^0y=WRQFZjz/aH`7dS"><mutation xmlns="http://www.w3.org/1999/xhtml" name="Reset"></mutation><field name="NAME">Reset</field></block></next></block></next></block></statement></block></next></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="%@},0=^nlUzf:}d~+im|" x="3272" y="2934"><field name="NAME">detectBit</field><statement name="STACK"><block type="controls_if" id="Q[-2+|Wf)P~a/*9KQ2Px"><mutation elseif="2"/><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="U=kP/_1.jQ]ST[[0[Gdo"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="*JH.;|,Im/dkGq}2[g_s"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">900</field></shadow><block type="variables_get" id="pK,80+`}kCTf2cuF#Yxz"><field name="VAR" id="Efzbu|C1dMKP|N*3Au0d">START_STOP_PAUSE</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="Si:bM%8AR#)E-I:Xpe+M"><field name="VAR" id="wp)V|84)6:#soyX:!3j]">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="XcQ]Jg[X(Zo=qrABp((L"><field name="VAR" id="!xR^S{WB`:PvtT0b8)`j">IRRCV_DETECT_START_STOP</field></block></value></block></statement><value name="IF1"><block type="logic_compare" id="=6B,lG}dL)o3?p7^](,*"><field name="OP">GT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="#[0--c`Mzd(n+nB8rl`e"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="*.[jWW)m{O7se$v2[eh3"><field name="NUM">600</field></shadow></value></block></value><statement name="DO1"><block type="procedures_callnoreturn" id="@kii|JWX:{,VT;#L=Nz!"><mutation xmlns="http://www.w3.org/1999/xhtml" name="pushBitOne"></mutation><field name="NAME">pushBitOne</field></block></statement><value name="IF2"><block type="logic_compare" id="}A$,2]R1myPm!yH^|$R["><field name="OP">LT</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="s/;ieW[3BW(:gtHK0iAD"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="/lawK:dBDzu(*?3HycUi"><field name="NUM">300</field></shadow></value></block></value><statement name="DO2"><block type="procedures_callnoreturn" id="(kuiB8OvqVf,KH)PF_N."><mutation xmlns="http://www.w3.org/1999/xhtml" name="pushBitZero"></mutation><field name="NAME">pushBitZero</field></block></statement></block></statement></block><block type="pins_on_pulsed" id="%M|r@-6Dl+lLM?c*e[=F" x="1863" y="3016"><field name="pin">DigitalPin.P2</field><field name="pulse">PulseValue.High</field><comment>// LOW</comment><statement name="HANDLER"><block type="variables_set" id="+QO#T,u+*_7%=U2]x2tk"><field name="VAR" id="Kp.RO.[J7X-h~j.xdk61">space</field><comment>pulse duration = a number that is the duration of the last pulse, measured in microseconds</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="pins_pulse_duration" id="BFf8Q_gfN8/pM{M|O)aJ"/></value><next><block type="control_raise_event" id="NYxMJv$%OtI~$z)h(7JB"><value name="src"><shadow type="control_event_source_id" id="R-EfrbL8xGvEwZJR|3I@"><field name="id">EventBusSource.MICROBIT_ID_IO_P19</field></shadow></value><value name="value"><shadow type="control_event_value_id"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow><block type="math_arithmetic" id="}-y7-q_XIlI3U^aCysi["><field name="OP">ADD</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="In$*(vW/RG:y-}j1kBBR"><field name="VAR" id="3*`ODRXGbqe2=MCX@o#c">mark</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="2IN~9HG$bv,b@aidX5+."><field name="VAR" id="Kp.RO.[J7X-h~j.xdk61">space</field></block></value></block></value></block></next></block></statement></block><block type="procedures_defnoreturn" id="p36O)GPjUVM;*@=kB%2A" x="3843" y="2920"><field name="NAME">pushBitZero</field><statement name="STACK"><block type="variables_set" id="w4}m0)0aFZvxv1#XcWpS"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field><comment>Shift left de 1 bit</comment><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="math_arithmetic" id="S)?Dh^oRmB-Ilm8uxa-b"><field name="OP">MULTIPLY</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="oaOwfJ!r9`cgn3s%QOk9"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field></block></value><value name="B"><shadow type="math_number" id="|eCs}ZO+jQ|$Qd$^Q#F["><field name="NUM">2</field></shadow></value></block></value><next><block type="variables_change" id="E}S??j[Vbh$7nyB5@iF7"><field name="VAR" id="zu?}[A{)NdL5sVf^7~p+">receivedBits</field><value name="VALUE"><shadow type="math_number" id="YF0Q6vIK1`90S+0^VPr="><field name="NUM">1</field></shadow></value><next><block type="controls_if" id="PP+$$0V+tl4h[J}Nca$s"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_compare" id="W**/%E:#BlxQ[Wv}eku{"><field name="OP">EQ</field><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Qm(Qr4Uoy#)GA+Q^sq-["><field name="VAR" id="zu?}[A{)NdL5sVf^7~p+">receivedBits</field></block></value><value name="B"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="9Kp.^HFW0-;R+j9}Wz:b"><field name="VAR" id="B2szGW!8E}]]er_vQ7^4">SHOT_MESSAGE_BIT_SIZE</field></block></value></block></value><statement name="DO0"><block type="variables_set" id="kNvrFl[Z3a1zeIfupzl7"><field name="VAR" id="{(G2a?)h6lgOH$!jDzr%">lasIRShotReceived</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="=a}LMe_oF:#-yhqrKhNY"><field name="VAR" id="x[,7+Lq3j3:KihVhZo-}">messageBeingReceived</field></block></value><next><block type="control_raise_event" id="5Emv8DTcwIGF#,_c]7[l"><value name="src"><shadow type="control_event_source_id" id="pid%ilp9Znq5kGA=0r*n"><field name="id">EventBusSource.MICROBIT_ID_IO_P20</field></shadow></value><value name="value"><shadow type="control_event_value_id"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow><block type="math_number" id="Oviwf1g8,;w^CJe),F.i"><field name="NUM">0</field></block></value><next><block type="procedures_callnoreturn" id="hsCD}8$t3nn|V+jeMOem"><mutation xmlns="http://www.w3.org/1999/xhtml" name="Reset"></mutation><field name="NAME">Reset</field></block></next></block></next></block></statement></block></next></block></next></block></statement></block><block type="procedures_defnoreturn" id="*qV6_%1OF_p-BH/K`UoA" x="931" y="3115"><field name="NAME">detectStartStop</field><statement name="STACK"><block type="controls_if" id="GXPC@,czyx:qwUq;_:HM"><value name="IF0"><shadow type="logic_boolean"><field name="BOOL">TRUE</field></shadow><block type="logic_operation" id="a4QOtOw8M|]q@{*!X9`Q"><field name="OP">AND</field><value name="A"><block type="logic_compare" id="fszWxtiftfPus0JS/8Vc"><field name="OP">GT</field><comment>Estamos a fornecer uma margem de erro para baixo e infinito para cima de 1500 que é o tempo de Low do pino 1.
No arranque o pulseToPulse será obviamente grande pois o led está apagado e P2 da Mircobit estará a High. O evento supostamente apenas é disparado no do período em que P2 esteve a High pois só assim a microbit nos poderia indicar o pulse duration.</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="ed=hSV?}2P]Y2I0TE`Xy"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="lN%qD@=-cA*1Cl+d!=OR"><field name="NUM">1300</field></shadow></value></block></value><value name="B"><block type="logic_compare" id="ugwYRK{f}iqDoXQYO$8c"><field name="OP">LT</field><comment>Estamos a fornecer uma margem de erro de 10% para baixo e infinito para cima</comment><value name="A"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="|5KafC#ct`aEW,],^^@S"><field name="VAR" id="fUkRRWW^p~%wEML_`~gz">pulseToPulse</field></block></value><value name="B"><shadow type="math_number" id="E@#7p;3Djt^qladHG4C."><field name="NUM">1700</field></shadow></value></block></value></block></value><statement name="DO0"><block type="variables_set" id="{l{3UoxcVfK8}kDX[ww$"><field name="VAR" id="wp)V|84)6:#soyX:!3j]">IRReceiveState</field><value name="VALUE"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="LGi]XPEt0kgQ8W:4W-Q1"><field name="VAR" id="dj9WtXqY!=LxpnOtS6TM">IRRCV_DETECT_BIT</field></block></value></block></statement></block></statement></block><block type="control_on_event" id="`Q7o85%rzZEXY7STjEJ!" x="5191" y="2974"><value name="src"><shadow type="control_event_source_id" id="{CYeFz!9RdHd;6]72eF["><field name="id">EventBusSource.MICROBIT_ID_IO_P20</field></shadow></value><value name="value"><shadow type="control_event_value_id" id="2LUhY`xNb=JW+%O}Cdos"><field name="id">EventBusValue.MICROBIT_EVT_ANY</field></shadow></value><statement name="HANDLER"><block type="device_show_leds" id=":^g=4!kp}qFIX*8eDm$9"><field name="LEDS">`
        . . . . . 
        . . . . . 
        . . # . . 
        . . . . . 
        . . . . .
        `</field><next><block type="device_show_number" id="^uyV0UIlJriE`@^YI^}T"><value name="number"><shadow type="math_number"><field name="NUM">0</field></shadow><block type="variables_get" id="Qf??0WYDa5b}B/Lv_x{H"><field name="VAR" id="{(G2a?)h6lgOH$!jDzr%">lasIRShotReceived</field></block></value><next><block type="device_pause" id="J8[vh?@3LbCitq.x%r.q"><value name="pause"><shadow type="timePicker" id="*;C^;rG8gThEb-vwhbTH"><field name="ms">1000</field></shadow></value><next><block type="device_clear_display" id="URW=7$:Fi(=SQI7fr_I:"/></next></block></next></block></next></block></statement></block></xml>